<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>A-Frame Scene with Custom Model</title>
    <script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>
    <script src="https://cdn.rawgit.com/donmccaslin/aframe-physics-system/master/dist/aframe-physics-system.min.js"></script>
</head>
<body>
    <a-scene physics>
        <!-- Sky with texture -->
        <a-sky src="skyy.png"></a-sky>

        <!-- Ground with texture -->
        <a-plane rotation="-90 0 0" position="0 0 0" width="1000" height="1000" src="travi.jpg" repeat="100 100" static-body></a-plane>

       <!-- Camera with controls -->
        <a-camera id="camera" position="0 1.6 0">
            <a-entity cursor="fuse: true; fuseTimeout: 500"
                      position="0 0 -1"
                      geometry="primitive: ring; radiusInner: 0.02; radiusOuter: 0.03"
                      material="color: black; shader: flat">
            </a-entity>
        </a-camera>

        <!-- Collectible Spheres -->
        <a-entity id="sphere1" geometry="primitive: sphere; radius: 0.5" material="color: red" position="-5 0.5 -5" class="collectible" dynamic-body></a-entity>
        <a-entity id="sphere2" geometry="primitive: sphere; radius: 0.5" material="color: blue" position="5 0.5 5" class="collectible" dynamic-body></a-entity>
        <a-entity id="sphere3" geometry="primitive: sphere; radius: 0.5" material="color: green" position="0 0.5 10" class="collectible" dynamic-body></a-entity>

        <!-- Collectible Cubes -->
        <a-entity id="cube1" geometry="primitive: box; width: 1; height: 1; depth: 1" material="color: yellow" position="10 0.5 -10" class="collectible" dynamic-body></a-entity>
        <a-entity id="cube2" geometry="primitive: box; width: 1; height: 1; depth: 1" material="color: purple" position="-10 0.5 10" class="collectible" dynamic-body></a-entity>
        <a-entity id="cube3" geometry="primitive: box; width: 1; height: 1; depth: 1" material="color: orange" position="-15 0.5 0" class="collectible" dynamic-body></a-entity>

        <!-- Scoreboard -->
         <a-entity id="scoreboard" position="-1 3 -4"
            geometry="primitive: plane; width: 2.2; height: 0.7"
            material="color: black"
            text="value: 0; color: white; align: center; width: 2; font: https://cdn.aframe.io/fonts/Roboto-msdf.json">
        </a-entity>

        <!-- Timer -->
         <a-entity id="timer" position="1 3 -4"
            geometry="primitive: plane; width: 2.2; height: 0.7"
            material="color: black"
            text="value: Time: 60; color: white; align: center; width: 2; font: https://cdn.aframe.io/fonts/Roboto-msdf.json">
        </a-entity>

       <!-- Game Over Text-->
        <a-entity id="gameOverText" position="0 2 -5"
            geometry="primitive: plane; width: 4; height: 1"
            material="color: black; opacity: 0.7"
            text="value: GAME OVER; color: red; align: center; width: 3; font: https://cdn.aframe.io/fonts/Roboto-msdf.json; visible: false" visible="false">
        </a-entity>
         <!-- Final Score Text-->
        <a-entity id="finalScoreText" position="0 1 -5"
            geometry="primitive: plane; width: 4; height: 1"
            material="color: black; opacity: 0.7"
            text="value: Score: 0; color: white; align: center; width: 3; font: https://cdn.aframe.io/fonts/Roboto-msdf.json; visible: false" visible="false">
        </a-entity>

        <!-- Restart Button -->
        <a-entity id="restartButton"
              geometry="primitive: box; width: 1.5; height: 0.5; depth: 0.1"
              material="color: gray"
              position="0 -1 -5"
              text="value: Restart; align: center; color: white; width: 2; font: https://cdn.aframe.io/fonts/Roboto-msdf.json"
              clickable>
         </a-entity>
        
         <!-- Custom Model -->
        <a-entity
            gltf-model="url(rantai.glb)"
            position="0 1 -8"
            rotation="0 45 0"
            scale="0.5 0.5 0.5">
        </a-entity>

    </a-scene>

    <script>
      let score = 0;
      const scoreboard = document.getElementById('scoreboard');
      let timeLeft = 60;
      const timerElement = document.getElementById('timer');
      const gameOverText = document.getElementById('gameOverText');
      const finalScoreText = document.getElementById('finalScoreText');
      let gameStarted = false;
      let timerInterval;
      const restartButton = document.getElementById('restartButton');

      function resetGame() {
            score = 0;
            timeLeft = 60;
            gameStarted = false;
            scoreboard.setAttribute('text', 'value: 0; color: white; align: center; width: 2; font: https://cdn.aframe.io/fonts/Roboto-msdf.json');
            timerElement.setAttribute('text', `value: Time: 60; color: white; align: center; width: 2; font: https://cdn.aframe.io/fonts/Roboto-msdf.json`);
            gameOverText.setAttribute('text', 'visible: false');
            finalScoreText.setAttribute('text', 'value: Score: 0; visible: false; color: white; align: center; width: 3; font: https://cdn.aframe.io/fonts/Roboto-msdf.json');
            clearInterval(timerInterval);

            // Remove existing collectibles
            document.querySelectorAll('.collectible').forEach(el => {
                el.parentNode.removeChild(el);
            });
            // Create collectibles again
            createCollectibles();
        }

      function createCollectibles(){
           const scene = document.querySelector('a-scene');

            const sphere1 = document.createElement('a-entity');
            sphere1.setAttribute('id', 'sphere1');
            sphere1.setAttribute('geometry', 'primitive: sphere; radius: 0.5');
            sphere1.setAttribute('material', 'color: red');
            sphere1.setAttribute('position', '-5 0.5 -5');
            sphere1.setAttribute('class', 'collectible');
            sphere1.setAttribute('dynamic-body', '');
            sphere1.setAttribute('collectible', '');
            scene.appendChild(sphere1);


             const sphere2 = document.createElement('a-entity');
            sphere2.setAttribute('id', 'sphere2');
            sphere2.setAttribute('geometry', 'primitive: sphere; radius: 0.5');
            sphere2.setAttribute('material', 'color: blue');
            sphere2.setAttribute('position', '5 0.5 5');
             sphere2.setAttribute('class', 'collectible');
            sphere2.setAttribute('dynamic-body', '');
             sphere2.setAttribute('collectible', '');
           scene.appendChild(sphere2);


             const sphere3 = document.createElement('a-entity');
            sphere3.setAttribute('id', 'sphere3');
            sphere3.setAttribute('geometry', 'primitive: sphere; radius: 0.5');
            sphere3.setAttribute('material', 'color: green');
            sphere3.setAttribute('position', '0 0.5 10');
             sphere3.setAttribute('class', 'collectible');
            sphere3.setAttribute('dynamic-body', '');
             sphere3.setAttribute('collectible', '');
           scene.appendChild(sphere3);


            const cube1 = document.createElement('a-entity');
            cube1.setAttribute('id', 'cube1');
            cube1.setAttribute('geometry', 'primitive: box; width: 1; height: 1; depth: 1');
            cube1.setAttribute('material', 'color: yellow');
            cube1.setAttribute('position', '10 0.5 -10');
            cube1.setAttribute('class', 'collectible');
            cube1.setAttribute('dynamic-body', '');
             cube1.setAttribute('collectible', '');
            scene.appendChild(cube1);... const cube2 = document.createElement('a-entity');
            cube2.setAttribute('id', 'cube2');
             cube2.setAttribute('geometry', 'primitive: box; width: 1; height: 1; depth: 1');
            cube2.setAttribute('material', 'color: purple');
             cube2.setAttribute('position', '-10 0.5 10');
            cube2.setAttribute('class', 'collectible');
           cube2.setAttribute('dynamic-body', '');
            cube2.setAttribute('collectible', '');
            scene.appendChild(cube2);


            const cube3 = document.createElement('a-entity');
             cube3.setAttribute('id', 'cube3');
             cube3.setAttribute('geometry', 'primitive: box; width: 1; height: 1; depth: 1');
            cube3.setAttribute('material', 'color: orange');
             cube3.setAttribute('position', '-15 0.5 0');
           cube3.setAttribute('class', 'collectible');
            cube3.setAttribute('dynamic-body', '');
            cube3.setAttribute('collectible', '');
            scene.appendChild(cube3);
        }

      function updateTimer() {
        timerElement.setAttribute('text', `value: Time: ${timeLeft}; color: white; align: center; width: 2; font: https://cdn.aframe.io/fonts/Roboto-msdf.json`);
         if (timeLeft <= 0) {
           clearInterval(timerInterval);
           gameOverText.setAttribute('text', 'visible: true')
            finalScoreText.setAttribute('text', `value: Final Score: ${score}; visible: true; color: white; align: center; width: 3; font: https://cdn.aframe.io/fonts/Roboto-msdf.json`)
            document.querySelectorAll('.collectible').forEach(el => {
              el.parentNode.removeChild(el);
            });
         } else {
            timeLeft--;
         }
      }

        restartButton.addEventListener('click', resetGame);

        AFRAME.registerComponent('clickable', {
            init: function () {
                this.el.addEventListener('click', () => {
                    this.el.emit('click');
                });
            }
         });


         AFRAME.registerComponent('collectible', {
           init: function () {
             this.el.addEventListener('collide', (event) => {
               if (event.detail.body.el.id === 'camera') {
                    if (!gameStarted) {
                       timerInterval = setInterval(updateTimer, 1000);
                       gameStarted = true;
                   }
                 score += 1;
                 scoreboard.setAttribute('text', `value: ${score}; color: white; align: center; width: 2; font: https://cdn.aframe.io/fonts/Roboto-msdf.json`);
                 console.log("Collected: ", this.el.id);
                 this.el.parentNode.removeChild(this.el);
               }
             });
           },
         });



       document.querySelectorAll('.collectible').forEach((el) => {
          el.setAttribute('collectible', '');
       });
    </script>
</body>
</html>
