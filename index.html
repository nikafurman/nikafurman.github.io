<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>A-Frame Game with Respawning Objects</title>
    <script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>
</head>
<body>
    <a-scene>
        <!-- Sky with texture -->
        <a-sky src="skyy.png"></a-sky>

        <!-- Ground with texture -->
        <a-plane rotation="-90 0 0" position="0 0 0" width="1000" height="1000" src="travi.jpg" repeat="100 100"></a-plane>

        <!-- Camera with controls -->
        <a-camera id="camera" position="0 1.6 0">
            <a-entity cursor="fuse: true; fuseTimeout: 500"
                      position="0 0 -1"
                      geometry="primitive: ring; radiusInner: 0.02; radiusOuter: 0.03"
                      material="color: black; shader: flat">
            </a-entity>
        </a-camera>

        <!-- VR Controllers -->
        <a-entity id="left-controller" laser-controls="hand: left"></a-entity>
        <a-entity id="right-controller" laser-controls="hand: right"></a-entity>

        <!-- Collectible Spheres -->
        <a-entity id="sphere1" geometry="primitive: sphere; radius: 0.5" material="color: red" position="-5 0.5 -5" class="collectible"></a-entity>
        <a-entity id="sphere2" geometry="primitive: sphere; radius: 0.5" material="color: blue" position="5 0.5 5" class="collectible"></a-entity>
        <a-entity id="sphere3" geometry="primitive: sphere; radius: 0.5" material="color: green" position="0 0.5 10" class="collectible"></a-entity>

        <!-- Collectible Cubes -->
        <a-entity id="cube1" geometry="primitive: box; width: 1; height: 1; depth: 1" material="color: yellow" position="10 0.5 -10" class="collectible"></a-entity>
        <a-entity id="cube2" geometry="primitive: box; width: 1; height: 1; depth: 1" material="color: purple" position="-10 0.5 10" class="collectible"></a-entity>
        <a-entity id="cube3" geometry="primitive: box; width: 1; height: 1; depth: 1" material="color: orange" position="-15 0.5 0" class="collectible"></a-entity>

        <!-- Scoreboard -->
        <a-entity id="scoreboard" position="-1 3 -4"
            geometry="primitive: plane; width: 2.2; height: 0.7"
            material="color: black"
            text="
                value : Score : 0 ; color : white ; align : center ; width :2 ; font : https://cdn.aframe.io/fonts/Roboto-msdf.json">
        </a-entity>

        <!-- Timer -->
        <a-entity id="timer" position="1 3 -4"
            geometry="primitive: plane; width: 2.2; height: 0.7"
            material="color: black"
            text="
                value : Time : 60 ; color : white ; align : center ; width :2 ; font : https://cdn.aframe.io/fonts/Roboto-msdf.json">
        </a-entity>

        <!-- Game Over Text -->
        <a-entity id="gameOverText" position="-1 2 -5"
            geometry="primitive: plane; width: 4; height: 1"
            material="color: black; opacity: 0.7"
            text="
                value : GAME OVER ; color : red ; align : center ; width :3 ; font : https://cdn.aframe.io/fonts/Roboto-msdf.json ; visible:false">
        </a-entity>

        <!-- Final Score Text -->
        <a-entity id="finalScoreText" position="-1 .5 -5"
            geometry="primitive: plane; width: 4; height: .7"
            material="color: black; opacity: 0.7"
            text="
                value : Score : 0 ; color : white ; align : center ; width :3 ; font : https://cdn.aframe.io/fonts/Roboto-msdf.json ; visible:false">
        </a-entity>

        <!-- Restart Button -->
        <a-entity id="restartButton"
            geometry="
                primitive : box ;
                width :1 .5 ;
                height : .5 ;
                depth : .1 "
            material = "color : gray "
            position = "0 -1 -5 "
            text = "
                value : Restart ;
                align : center ;
                color : white ;
                width :2 ;
                font : https://cdn.aframe.io/fonts/Roboto-msdf.json "
            visible = "false">
        </a-entity>

    </a-scene>

    <script>
      let score = 0;
      let timeLeft = 60;
      const timerElement = document.querySelector('#timer');
      const scoreboard = document.querySelector('#scoreboard');

      // Функция для обновления таймера
      function updateTimer() {
          if (timeLeft > 0) {
              timeLeft--;
              timerElement.setAttribute('text', 'value', 'Time:' + timeLeft);
          } else {
              endGame();
          }
      }

      setInterval(updateTimer, 1000); // Запускаем таймер

      // Функция завершения игры
      function endGame() {
          // Показываем текст "Game Over"
          document.querySelector('#gameOverText').setAttribute('visible', true);
          document.querySelector('#finalScoreText').setAttribute('text', 'value', 'Score:' + score);
          document.querySelector('#finalScoreText').setAttribute('visible', true);
          document.querySelector('#restartButton').setAttribute('visible', true);
      }

      // Функция для создания collectible объектов
      function createCollectible(position) {
          const collectible = document.createElement('a-entity');
          collectible.setAttribute('geometry', 'primitive:sphere; radius:.5');
          collectible.setAttribute('material', 'color:red');
          collectible.setAttribute('position', position);
          collectible.setAttribute('class', 'collectible');
          
          // Добавляем обработчик событий для сбора объекта
          collectible.addEventListener('click', () => {
              score++;
              scoreboard.setAttribute('text', 'value', 'Score:' + score);
              collectible.parentNode.removeChild(collectible); // Удаляем объект
              setTimeout(() => createCollectible(position), 2000); // Возвращаем объект через время
          });
          
          return collectible;
      }

      // Создание объектов при загрузке
      const positions = [
          '-5 0.5 -5',
          '5 0.5 -5',
          '-10 0.5 -10',
          '10 0.5 -10',
          '-15 .5 -15'
      ];
      
      positions.forEach(pos => {
          const collectible = createCollectible(pos);
          document.querySelector('a-scene').appendChild(collectible);
      });

      // Обработчик события для перезапуска игры
      document.querySelector('#restartButton').addEventListener('click', () => {
          score = 0;
          timeLeft = 60;
          scoreboard.setAttribute('text', 'value', 'Score:' + score);
          timerElement.setAttribute('text', 'value', 'Time:' + timeLeft);
          
          // Скрываем текст Game Over и финальный счет
          document.querySelector('#gameOverText').setAttribute('visible', false);
          document.querySelector('#finalScoreText').setAttribute('visible', false);
          
          // Убираем кнопку перезапуска
          document.querySelector('#restartButton').setAttribute('visible', false);

          // Пересоздаем collectibles
          positions.forEach(pos => {
              const collectible = createCollectible(pos);
              document.querySelector('a-scene').appendChild(collectible);
          });
      });

    </script>
</body>
</html>
